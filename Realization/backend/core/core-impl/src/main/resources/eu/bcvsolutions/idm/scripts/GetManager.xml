<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--
Returns IdM manager for main contract.
-->
<script xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="IdmScript.xsd">
  <code>GetManager</code>
  <name>GetManager</name>
  <body><![CDATA[package eu.bcvsolutions.idm.scripts.rules;

import eu.bcvsolutions.idm.core.api.dto.filter.IdmIdentityFilter;

def contract = scriptEvaluator.evaluate(scriptEvaluator.newBuilder()
        .setScriptCode('ldapContract')
        .addParameter('scriptEvaluator', scriptEvaluator)
        .addParameter('identityId', entity.id)
        .build())
//
if (contract == null) {
    return null
}
//
def filter = new IdmIdentityFilter()
filter.setManagersFor(entity.id)
filter.setManagersByContract(contract.id)
//
def managersPage = identityService.find(filter, null)
for (def manager : managersPage) {
    return manager
}
return null]]></body>
<type>groovy</type>
  <category>TRANSFORM_TO</category>
  <description>Returns IdM manager for main contract.</description>
    <services>
        <service>
            <name>identityService</name>
            <className>eu.bcvsolutions.idm.core.model.service.impl.DefaultIdmIdentityService</className>            
        </service>
    </services>
    <allowClasses>
        <allowClass>
            <className>eu.bcvsolutions.idm.core.api.dto.IdmIdentityContractDto</className>
        </allowClass>
        <allowClass>
            <className>eu.bcvsolutions.idm.core.api.dto.filter.IdmIdentityFilter</className>
        </allowClass>
        <allowClass>
            <className>org.springframework.data.domain.PageImpl</className>
        </allowClass>
        <allowClass>
            <className>eu.bcvsolutions.idm.core.api.dto.IdmIdentityDto</className>
        </allowClass>
    </allowClasses>
</script>
